<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>üéÑ Magical Coin of Fate - Festive Christmas Fortune Teller | Digital Coin Flip</title>
    <meta name="title" content="üéÑ Magical Coin of Fate - Festive Christmas Fortune Teller | Digital Coin Flip">
    <meta name="description" content="üéÖ Dare to flip the magical Christmas coin? Experience festive fortune-telling with our enchanted digital coin flip tool. Merry animations, joyful sounds, and mystical predictions await. Perfect for Christmas decisions and holiday fun!">
    <meta name="keywords" content="christmas coin flip, magical coin toss, festive fortune teller, christmas decision maker, naughty or nice coin, christmas game, festive coin flip, magical fortune, christmas fun, digital christmas coin, holiday fortune teller, christmas party game, festive decision tool">
    <meta name="author" content="Magical Coin of Fate">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <meta name="language" content="English">
    <meta name="revisit-after" content="3 days">

    <!-- Canonical URL - Fixed Netlify duplicate content -->
    <link rel="canonical" href="https://coinoffate.live/">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/public/favicon.svg">
    <link rel="icon" type="image/png" sizes="192x192" href="/public/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/public/icon-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://coinoffate.live/">
    <meta property="og:title" content="üéÑ Magical Coin of Fate - Festive Christmas Fortune Teller">
    <meta property="og:description" content="üéÖ Dare to flip the magical Christmas coin? Experience festive fortune-telling with enchanted animations, joyful sounds, and mystical predictions. Perfect for Christmas fun!">
    <meta property="og:image" content="https://coinoffate.live/public/icon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:alt" content="Magical Christmas Coin - Festive Fortune Teller">
    <meta property="og:site_name" content="Magical Coin of Fate">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://coinoffate.live/">
    <meta name="twitter:title" content="üéÑ Magical Coin of Fate - Festive Christmas Fortune Teller">
    <meta name="twitter:description" content="üéÖ Dare to flip the magical Christmas coin? Enchanted animations, joyful sounds, and mystical predictions await!">
    <meta name="twitter:image" content="https://coinoffate.live/public/icon-512.png">
    <meta name="twitter:image:alt" content="Magical Christmas Coin Fortune Teller">

    <!-- Theme Color - Christmas Red -->
    <meta name="theme-color" content="#C41E3A">
    <meta name="msapplication-TileColor" content="#0a1a0a">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/public/manifest.json">

    <!-- Humans.txt -->
    <link rel="author" href="/public/humans.txt">

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- JSON-LD Structured Data - Christmas Optimized -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Magical Coin of Fate - Christmas Fortune Teller",
      "alternateName": "Festive Christmas Coin Flip",
      "url": "https://coinoffate.live/",
      "description": "Dare to flip the magical Christmas coin? Experience festive fortune-telling with our enchanted digital coin flip tool. Merry animations, joyful sounds, and mystical predictions. Perfect for Christmas parties and festive decision-making.",
      "applicationCategory": "EntertainmentApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "Magical Coin of Fate",
        "url": "https://coinoffate.live/"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "ratingCount": "256",
        "reviewCount": "89"
      },
      "keywords": "christmas coin flip, magical coin toss, festive fortune teller, christmas decision maker, naughty or nice coin, christmas game, festive coin flip, christmas party game, holiday fortune teller, magical fortune"
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Magical Coin of Fate",
      "url": "https://coinoffate.live/",
      "logo": "https://coinoffate.live/public/icon-512.png",
      "sameAs": [
        "https://coinoffate.live/"
      ],
      "description": "Festive Christmas fortune-telling and decision-making tool with magical animations and festive predictions"
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Magical Coin of Fate",
      "url": "https://coinoffate.live/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://coinoffate.live/?s={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is the Magical Coin of Fate?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The Magical Coin of Fate is a festive Christmas-themed digital coin flip tool that helps you make decisions with holiday magic. It features enchanted animations, joyful sound effects, and mystical fortune-telling quotes."
          }
        },
        {
          "@type": "Question",
          "name": "Is this a real fortune teller?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This is a fun Christmas-themed entertainment tool using probability algorithms. While the festive theme adds atmosphere, the coin flips are generated using Markov chain probability for entertainment purposes only."
          }
        }
      ]
    }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow-x: hidden;
        }

        @keyframes festiveFloat {
            0% { transform: translateX(0px) translateY(0px) rotate(0deg); }
            25% { transform: translateX(-30px) translateY(-20px) rotate(-5deg); }
            50% { transform: translateX(0px) translateY(-40px) rotate(0deg); }
            75% { transform: translateX(30px) translateY(-20px) rotate(5deg); }
            100% { transform: translateX(0px) translateY(0px) rotate(0deg); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes merryGlow {
            0%, 100% { opacity: 1; box-shadow: 0 0 30px rgba(196, 30, 58, 0.6); }
            50% { opacity: 0.7; box-shadow: 0 0 60px rgba(196, 30, 58, 0.9); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            75% { opacity: 0.9; }
        }

        @keyframes starTwinkle {
            0% { transform: translateX(0) translateY(0) rotate(0deg); }
            25% { transform: translateX(-30px) translateY(15px) rotate(-10deg); }
            50% { transform: translateX(-50px) translateY(-10px) rotate(5deg); }
            75% { transform: translateX(-30px) translateY(20px) rotate(-5deg); }
            100% { transform: translateX(0) translateY(0) rotate(0deg); }
        }

        @keyframes snowflakeFloat {
            0% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-20px) rotate(3deg); opacity: 0.9; }
            100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
        }

        @keyframes snowDrift {
            0% { transform: translateX(0%) scaleY(1); }
            50% { transform: translateX(-10%) scaleY(1.1); }
            100% { transform: translateX(0%) scaleY(1); }
        }

        .festive-flow {
            animation: festiveFloat 20s ease-in-out infinite;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-pulse {
            animation: merryGlow 2s infinite;
        }

        .twinkle {
            animation: twinkle 3s infinite;
        }

        .coin-container {
            box-shadow: 0 0 80px rgba(196, 30, 58, 0.5), inset 0 0 80px rgba(22, 91, 51, 0.2);
            background: radial-gradient(circle at center, rgba(22, 91, 51, 0.3), rgba(0, 0, 0, 0.8));
        }

        .bg-gradient-text {
            background: linear-gradient(90deg, #C41E3A, #FFD700, #165B33);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(196, 30, 58, 0.8);
        }

        .star {
            animation: starTwinkle 4s ease-in-out infinite;
        }

        .snowflake {
            animation: snowflakeFloat 5s ease-in-out infinite;
        }

        .snow {
            animation: snowDrift 15s ease-in-out infinite;
        }

        /* Festive glow effect */
        .festive-glow {
            filter: drop-shadow(0 0 10px rgba(196, 30, 58, 0.7));
        }

        /* Magical text shadow */
        .magical-text {
            text-shadow:
                0 0 10px rgba(196, 30, 58, 0.8),
                0 0 20px rgba(255, 215, 0, 0.6),
                0 0 30px rgba(22, 91, 51, 0.4);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading Screen - Christmas -->
        <div id="loading" class="min-h-screen bg-black text-red-500 font-mono relative overflow-hidden">
            <div class="absolute inset-0">
                <div id="snow-layer" class="snow"></div>
                <div id="christmas-snow"></div>
            </div>
            <div class="relative z-10 flex items-center justify-center min-h-screen">
                <div class="text-center px-4">
                    <div class="text-6xl mb-6 festive-glow">üéÑ</div>
                    <div class="text-4xl mb-4 twinkle font-light tracking-wider magical-text" style="font-family: Georgia, serif;">
                        Magical Coin of Fate
                    </div>
                    <div class="text-lg text-red-400 italic mb-2">
                        "Believe... the magic is real"
                    </div>
                    <div class="text-sm text-gray-500 mb-8">
                        Dare you flip the magical coin?
                    </div>
                    <div class="mt-8">
                        <button onclick="startApp()" class="px-8 py-3 border-2 border-red-500 text-red-500 hover:bg-red-500 hover:text-black transition-all duration-300 font-light tracking-wider festive-glow">
                            ENTER THE MAGIC
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="min-h-screen bg-black text-white relative overflow-hidden" style="display: none;">
            <!-- Background - Christmas Theme -->
            <div class="absolute inset-0">
                <div class="absolute inset-0 bg-gradient-to-br from-red-900/20 via-black to-green-900/20"></div>
                <div class="absolute inset-0 opacity-40 festive-flow" style="
                    background-image:
                        radial-gradient(circle at 30% 70%, rgba(196,30,58,0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 30%, rgba(22,91,51,0.08) 0%, transparent 50%),
                        repeating-linear-gradient(45deg, transparent, transparent 100px, rgba(196,30,58,0.02) 102px),
                        repeating-linear-gradient(-45deg, transparent, transparent 100px, rgba(22,91,51,0.02) 102px);
                    background-size: 400px 400px, 300px 300px, 200px 200px, 200px 200px;
                "></div>

                <!-- Floating Christmas elements -->
                <div class="absolute inset-0" id="floating-elements"></div>

                <!-- Snow layer -->
                <div class="absolute bottom-0 left-0 right-0 h-64 bg-gradient-to-t from-gray-900/30 to-transparent snow"></div>
            </div>

            <!-- Header - Christmas -->
            <div class="relative text-center py-16 px-4 border-b border-red-800/30">
                <div class="flex items-center justify-center gap-4 mb-8">
                    <div class="w-12 h-12 text-red-500 flex items-center justify-center text-4xl snowflake">‚≠ê</div>
                    <div class="text-center">
                        <h1 class="text-6xl font-bold tracking-widest bg-gradient-text mb-2 magical-text" style="font-family: Georgia, serif;">
                            MAGICAL COIN
                        </h1>
                        <div class="text-lg text-red-400 italic font-light tracking-wider twinkle" style="font-family: Georgia, serif;">
                            "Santa's magic awaits..."
                        </div>
                        <div class="text-sm text-gray-500 mt-2">
                            Your fate sparkles in the winter night
                        </div>
                    </div>
                    <div class="w-12 h-12 text-red-500 flex items-center justify-center text-4xl snowflake" style="animation-delay: 2s;">‚≠ê</div>
                </div>

                <div id="premium-badge" class="inline-flex items-center gap-2 px-4 py-2 border border-red-500/50 rounded bg-red-900/20 festive-glow" style="display: none;">
                    <span>üéÑ</span>
                    <span class="text-sm tracking-wide text-red-400 font-light">MAGICAL PREMIUM</span>
                </div>
            </div>

            <!-- Quote Section - Christmas -->
            <div id="quote-section" class="relative py-12 px-6 border-b border-red-800/20">
                <div class="max-w-2xl mx-auto text-center">
                    <div class="text-4xl mb-4">üéÑ</div>
                    <p id="current-quote" class="text-xl text-red-300 italic leading-relaxed font-light twinkle" style="font-family: Georgia, serif;">
                        "The magic whispers your fortune..."
                    </p>
                    <p id="quote-translation" class="text-sm text-gray-500 mt-3 tracking-wider font-light">
                        What fate awaits on this magical night?
                    </p>
                </div>
            </div>

            <!-- Main Coin Section - Christmas -->
            <div class="relative max-w-lg mx-auto px-6 py-16">
                <!-- Coin -->
                <div class="flex justify-center mb-16">
                    <div class="relative">
                        <div id="coin" class="w-64 h-64 rounded-full border-4 border-red-500 shadow-2xl flex items-center justify-center transform transition-all duration-2500 hover:scale-105 coin-container animate-pulse">
                            <div id="coin-content" class="text-center">
                                <div class="text-8xl mb-4 festive-glow">üéÑ</div>
                                <div class="text-lg text-red-300 tracking-wider font-light magical-text">READY FOR MAGIC</div>
                            </div>
                        </div>

                        <!-- Magical glow rings -->
                        <div class="absolute inset-0 rounded-full border border-red-500/40 scale-110 animate-pulse"></div>
                        <div class="absolute inset-0 rounded-full border border-red-500/20 scale-125 animate-pulse" style="animation-delay: 1s;"></div>
                        <div class="absolute inset-0 rounded-full border border-green-500/20 scale-140 animate-pulse" style="animation-delay: 2s;"></div>

                        <!-- Floating snowflakes around coin -->
                        <div class="absolute -left-12 top-1/4 text-3xl snowflake" style="animation-delay: 0.5s;">‚ùÑÔ∏è</div>
                        <div class="absolute -right-12 top-1/3 text-3xl snowflake" style="animation-delay: 1.5s;">‚ùÑÔ∏è</div>
                    </div>
                </div>

                <!-- Flip Button - Christmas -->
                <div class="text-center mb-12">
                    <button id="flip-btn" onclick="flipCoin()" class="px-16 py-5 border-2 border-red-500 hover:bg-red-500 hover:text-black transition-all duration-300 font-bold tracking-widest text-xl transform hover:scale-105 festive-glow magical-text" style="font-family: Georgia, serif;">
                        üéÑ DISCOVER FATE üéÑ
                    </button>
                </div>

                <!-- Stats - Christmas -->
                <div class="grid grid-cols-3 gap-6 mb-12">
                    <div class="text-center p-6 border border-red-800/30 bg-red-900/10 rounded festive-glow">
                        <div class="text-3xl mb-2">üéÅ</div>
                        <div id="total-count" class="text-4xl font-bold text-red-400 mb-2 magical-text" style="font-family: Georgia, serif;">0</div>
                        <div class="text-xs text-gray-500 tracking-wider font-light">FLIPS</div>
                    </div>
                    <div class="text-center p-6 border border-red-800/30 bg-red-900/10 rounded festive-glow">
                        <div class="text-3xl mb-2">üéÖ</div>
                        <div id="heads-count" class="text-4xl font-bold text-red-400 mb-2 magical-text" style="font-family: Georgia, serif;">0</div>
                        <div class="text-xs text-gray-500 tracking-wider font-light">NICE</div>
                    </div>
                    <div class="text-center p-6 border border-red-800/30 bg-red-900/10 rounded festive-glow">
                        <div class="text-3xl mb-2">‚õÑ</div>
                        <div id="tails-count" class="text-4xl font-bold text-red-400 mb-2 magical-text" style="font-family: Georgia, serif;">0</div>
                        <div class="text-xs text-gray-500 tracking-wider font-light">NAUGHTY</div>
                    </div>
                </div>

                <!-- History - Christmas -->
                <div id="history-section" class="mb-12" style="display: none;">
                    <h3 class="text-center text-lg font-light mb-6 tracking-wider text-red-400 twinkle" style="font-family: Georgia, serif;">
                        ‚≠ê Magical Chronicle ‚≠ê
                    </h3>
                    <div class="flex justify-center">
                        <div id="history-display" class="flex gap-3"></div>
                    </div>
                </div>

                <!-- Free Limit Warning - Christmas -->
                <div id="limit-warning" class="mb-8 p-4 border-2 border-red-600/60 bg-red-900/30 text-center rounded festive-glow" style="display: none;">
                    <div class="text-3xl mb-2">‚ö†Ô∏è</div>
                    <p class="text-red-300 text-sm font-light">
                        The magic is fading... <span id="remaining-flips">2</span> flips remaining!
                    </p>
                </div>

                <!-- Reset Button - Christmas -->
                <div class="text-center">
                    <button onclick="resetApp()" class="px-10 py-3 border border-gray-700 hover:border-red-500 text-gray-500 hover:text-red-400 transition-all duration-300 font-light tracking-wider" style="font-family: Georgia, serif;">
                        ‚ùÑÔ∏è RESET MAGIC ‚ùÑÔ∏è
                    </button>
                </div>
            </div>

            <!-- Subscription Modal - Christmas -->
            <div id="subscription-modal" class="fixed inset-0 bg-black/95 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-gradient-to-br from-red-900/30 to-black border-2 border-red-500 p-8 max-w-md w-full text-center relative rounded festive-glow">
                    <div class="absolute inset-0 bg-red-500/5 rounded"></div>
                    <div class="relative z-10">
                        <div class="mb-6">
                            <div class="text-6xl mx-auto mb-6 twinkle">üéÑ</div>
                            <h2 class="text-3xl font-bold mb-4 tracking-wider text-red-400 magical-text" style="font-family: Georgia, serif;">
                                Unleash Christmas Magic
                            </h2>
                            <p class="text-gray-300 leading-relaxed font-light">
                                Santa's magic awaits for unlimited festive flips...
                            </p>
                        </div>

                        <div class="border-2 border-red-800/50 p-6 mb-8 bg-red-900/20 rounded festive-glow">
                            <div class="text-4xl font-bold text-red-400 mb-4 magical-text" style="font-family: Georgia, serif;">$2.99/month</div>
                            <div class="space-y-3 text-sm text-gray-300 font-light">
                                <div class="flex items-center justify-center gap-3">
                                    <span>‚ôæÔ∏è</span>
                                    <span>Unlimited magical flips</span>
                                </div>
                                <div class="flex items-center justify-center gap-3">
                                    <span>üéÑ</span>
                                    <span>Magical Premium badge</span>
                                </div>
                                <div class="flex items-center justify-center gap-3">
                                    <span>üîî</span>
                                    <span>Exclusive festive sound effects</span>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <button onclick="buyPremium()" class="w-full py-3 bg-red-500 text-black hover:bg-red-400 transition-all duration-300 font-bold tracking-wider festive-glow" style="font-family: Georgia, serif;">
                                üéÑ UNLOCK UNLIMITED MAGIC üéÑ
                            </button>
                            <button onclick="closeModal()" class="w-full py-3 border border-gray-600 hover:border-red-500 text-gray-400 hover:text-red-400 transition-all duration-300 font-light tracking-wider" style="font-family: Georgia, serif;">
                                MAYBE LATER
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer - Christmas -->
            <div class="relative border-t border-red-800/30 py-8 text-center">
                <div class="space-y-3 text-xs text-gray-600 font-light">
                    <div class="flex justify-center gap-4 text-2xl mb-4">
                        <span class="snowflake">‚ùÑÔ∏è</span>
                        <span class="star">‚≠ê</span>
                        <span class="snowflake" style="animation-delay: 1s;">‚ùÑÔ∏è</span>
                        <span class="star" style="animation-delay: 2s;">‚≠ê</span>
                        <span class="snowflake" style="animation-delay: 3s;">‚ùÑÔ∏è</span>
                    </div>
                    <p class="text-red-500/70">Powered by Magical Markov Chain Probability</p>
                    <p style="font-family: Georgia, serif;" class="italic">"In the winter night, your fate sparkles..."</p>
                    <p class="text-xs">Merry Christmas! üéÑ | Made with holiday magic</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let tosses = 0;
        let history = [];
        let isPremium = false;
        let markovState = 'H';
        let isFlipping = false;

        const markovMatrix = {
            'H': { 'H': 0.45, 'T': 0.55 },
            'T': { 'H': 0.55, 'T': 0.45 }
        };

        // Christmas magical quotes
        const magicalQuotes = [
            "The magic has spoken... believe in wonder|Your fate sparkles with holiday joy",
            "Embrace the wonder... miracles await|Magic reveals joyful truths",
            "The veil of magic grows strong|What Christmas brings beckons you",
            "Ancient magic guides your destiny|The festive realm calls",
            "In starlight, truth is revealed|Your fortune awaits in wonder",
            "The magical coin knows your fate|Christmas powers at work",
            "Elves dance in the moonlight|Your destiny is written in snow",
            "The magical realm has chosen|Festive energies surround you",
            "Embrace what the magic brings|Fortune favors the merry souls",
            "The joyful voices sing out|Your path is illuminated by starlight",
            "Naughty or nice, fate awaits|Santa decides your fortune",
            "Eternal magic guides the coin|Festive forces align"
        ];

        // Sound effects (using Web Audio API for festive sounds)
        let audioContext;
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playMagicalChime() {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.5);

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function playJingleSound() {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1500, audioContext.currentTime + 0.3);

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Christmas snow effect (falling snowflakes and stars)
        function createChristmasSnow() {
            const container = document.getElementById('christmas-snow');
            const christmasChars = ['‚ùÑÔ∏è', '‚≠ê', '‚ú®', 'üéÑ', 'üîî'];
            const columns = Math.floor(window.innerWidth / 50);

            for (let i = 0; i < columns; i++) {
                const drop = document.createElement('div');
                drop.style.position = 'absolute';
                drop.style.left = i * 50 + 'px';
                drop.style.top = Math.random() * -1000 + 'px';
                drop.style.fontSize = '20px';
                drop.style.opacity = '0.3';
                drop.style.animation = `fall ${5 + Math.random() * 8}s linear infinite`;
                drop.style.animationDelay = Math.random() * 5 + 's';

                drop.textContent = christmasChars[Math.floor(Math.random() * christmasChars.length)];
                container.appendChild(drop);
            }
        }

        // Create floating Christmas elements
        function createFloatingElements() {
            const container = document.getElementById('floating-elements');
            const elements = ['‚ùÑÔ∏è', '‚≠ê', 'üéÅ', 'üéÑ', 'üîî', '‚õÑ'];

            for (let i = 0; i < 20; i++) {
                const element = document.createElement('div');
                element.className = 'absolute opacity-20 text-2xl';
                element.style.left = Math.random() * 100 + '%';
                element.style.top = Math.random() * 100 + '%';

                // Alternate between star and snowflake animations
                if (i % 2 === 0) {
                    element.className += ' star';
                } else {
                    element.className += ' snowflake';
                }

                element.style.animationDelay = Math.random() * 5 + 's';
                element.style.animationDuration = (4 + Math.random() * 4) + 's';
                element.textContent = elements[Math.floor(Math.random() * elements.length)];
                container.appendChild(element);
            }
        }

        // Create spooky particle burst effect
        function createParticleBurst(x, y) {
            const particles = ['‚ú®', '‚≠ê', 'üí´', 'üåü'];
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'absolute text-2xl';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.pointerEvents = 'none';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];

                const angle = (i / 12) * Math.PI * 2;
                const velocity = 100 + Math.random() * 100;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 1000,
                    easing: 'cubic-bezier(0, .9, .57, 1)'
                });

                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        // Start app
        function startApp() {
            playJingleSound();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            createFloatingElements();
            updateQuote();
        }

        // Update quote - Christmas version
        function updateQuote() {
            const quote = magicalQuotes[Math.floor(Math.random() * magicalQuotes.length)];
            const parts = quote.split('|');
            document.getElementById('current-quote').textContent = `"${parts[0]}"`;
            document.getElementById('quote-translation').textContent = parts[1];
        }

        // Markov prediction
        function getMarkovPrediction() {
            const probabilities = markovMatrix[markovState];
            const random = Math.random();
            return random < probabilities['H'] ? 'H' : 'T';
        }

        // Flip coin - Christmas version with sound effects
        function flipCoin() {
            if (!isPremium && tosses >= 10) {
                playMagicalChime();
                document.getElementById('subscription-modal').style.display = 'flex';
                return;
            }

            if (isFlipping) return;

            isFlipping = true;
            playJingleSound();

            const coin = document.getElementById('coin');
            const coinContent = document.getElementById('coin-content');
            const flipBtn = document.getElementById('flip-btn');

            coin.classList.add('animate-spin');
            coin.style.transform = 'scale(1.2)';
            flipBtn.textContent = '‚ú® MAGIC IN PROGRESS... ‚ú®';
            flipBtn.disabled = true;

            coinContent.innerHTML = `
                <div class="text-9xl animate-pulse mb-4 festive-glow">üåü</div>
                <div class="text-lg text-red-300 tracking-wider font-light animate-pulse magical-text">SANTA DECIDING...</div>
            `;

            // Create particle effects during spin
            setTimeout(() => {
                const coinRect = coin.getBoundingClientRect();
                const centerX = coinRect.left + coinRect.width / 2;
                const centerY = coinRect.top + coinRect.height / 2;
                createParticleBurst(centerX, centerY);
            }, 1000);

            setTimeout(() => {
                playMagicalChime();

                const result = getMarkovPrediction();
                markovState = result;
                history = [result, ...history.slice(0, 9)];
                tosses++;

                coin.classList.remove('animate-spin');
                coin.style.transform = 'scale(1)';

                // Naughty or Nice result
                const isNice = result === 'H';
                coinContent.innerHTML = `
                    <div class="text-9xl mb-3 festive-glow">${isNice ? 'üéÖ' : '‚õÑ'}</div>
                    <div class="text-2xl text-red-400 tracking-wider font-bold magical-text">${isNice ? 'NICE!' : 'NAUGHTY!'}</div>
                `;

                updateStats();
                updateHistory();
                updateQuote();
                checkLimit();

                flipBtn.textContent = 'üéÑ DISCOVER FATE üéÑ';
                flipBtn.disabled = false;
                isFlipping = false;
            }, 2500);
        }

        // Update stats
        function updateStats() {
            document.getElementById('total-count').textContent = tosses;
            document.getElementById('heads-count').textContent = history.filter(h => h === 'H').length;
            document.getElementById('tails-count').textContent = history.filter(h => h === 'T').length;
        }

        // Update history - Christmas version
        function updateHistory() {
            if (history.length > 0) {
                document.getElementById('history-section').style.display = 'block';
                const historyDisplay = document.getElementById('history-display');
                historyDisplay.innerHTML = '';

                history.forEach(flip => {
                    const element = document.createElement('div');
                    const isNice = flip === 'H';
                    element.className = `w-12 h-12 rounded-full border-2 flex items-center justify-center text-2xl ${
                        isNice
                            ? 'bg-red-500 border-red-500 festive-glow'
                            : 'bg-green-900/50 border-red-400 festive-glow'
                    }`;
                    element.textContent = isNice ? 'üéÖ' : '‚õÑ';
                    historyDisplay.appendChild(element);
                });
            }
        }

        // Check limit
        function checkLimit() {
            if (!isPremium && tosses >= 8) {
                const remaining = 10 - tosses;
                document.getElementById('remaining-flips').textContent = remaining;
                document.getElementById('limit-warning').style.display = 'block';
            }
        }

        // Buy premium
        function buyPremium() {
            isPremium = true;
            document.getElementById('subscription-modal').style.display = 'none';
            document.getElementById('premium-badge').style.display = 'inline-flex';
            document.getElementById('limit-warning').style.display = 'none';
        }

        // Close modal
        function closeModal() {
            document.getElementById('subscription-modal').style.display = 'none';
        }

        // Reset app - Christmas version
        function resetApp() {
            playJingleSound();
            tosses = 0;
            history = [];
            markovState = 'H';

            document.getElementById('coin-content').innerHTML = `
                <div class="text-8xl mb-4 festive-glow">üéÑ</div>
                <div class="text-lg text-red-300 tracking-wider font-light magical-text">READY FOR MAGIC</div>
            `;

            updateStats();
            document.getElementById('history-section').style.display = 'none';
            document.getElementById('limit-warning').style.display = 'none';
            updateQuote();
        }

        // Add CSS animation for falling
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    transform: translateY(100vh);
                }
            }
        `;
        document.head.appendChild(style);

        // Initialize Christmas snow
        createChristmasSnow();
    </script>
</body>
</html>