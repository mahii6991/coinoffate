<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>🎃 Haunted Coin of Fate - Spooky Halloween Fortune Teller | Digital Coin Flip</title>
    <meta name="title" content="🎃 Haunted Coin of Fate - Spooky Halloween Fortune Teller | Digital Coin Flip">
    <meta name="description" content="🦇 Dare to flip the cursed Halloween coin? Experience supernatural fortune-telling with our haunted digital coin flip tool. Spooky animations, eerie sounds, and mystical predictions await. Perfect for Halloween decisions and spooky fun!">
    <meta name="keywords" content="halloween coin flip, haunted coin toss, spooky fortune teller, halloween decision maker, trick or treat coin, halloween game, spooky coin flip, haunted fortune, halloween fun, digital halloween coin, scary fortune teller, halloween party game, spooky decision tool">
    <meta name="author" content="Haunted Coin of Fate">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <meta name="language" content="English">
    <meta name="revisit-after" content="3 days">

    <!-- Canonical URL - Fixed Netlify duplicate content -->
    <link rel="canonical" href="https://coinoffate.live/">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/public/favicon.svg">
    <link rel="icon" type="image/png" sizes="192x192" href="/public/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/public/icon-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://coinoffate.live/">
    <meta property="og:title" content="🎃 Haunted Coin of Fate - Spooky Halloween Fortune Teller">
    <meta property="og:description" content="🦇 Dare to flip the cursed Halloween coin? Experience supernatural fortune-telling with haunted animations, eerie sounds, and mystical predictions. Perfect for Halloween fun!">
    <meta property="og:image" content="https://coinoffate.live/public/icon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:alt" content="Haunted Halloween Coin - Spooky Fortune Teller">
    <meta property="og:site_name" content="Haunted Coin of Fate">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://coinoffate.live/">
    <meta name="twitter:title" content="🎃 Haunted Coin of Fate - Spooky Halloween Fortune Teller">
    <meta name="twitter:description" content="🦇 Dare to flip the cursed Halloween coin? Haunted animations, eerie sounds, and mystical predictions await!">
    <meta name="twitter:image" content="https://coinoffate.live/public/icon-512.png">
    <meta name="twitter:image:alt" content="Haunted Halloween Coin Fortune Teller">

    <!-- Theme Color - Halloween Orange -->
    <meta name="theme-color" content="#FF6B00">
    <meta name="msapplication-TileColor" content="#1a0a00">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/public/manifest.json">

    <!-- Humans.txt -->
    <link rel="author" href="/public/humans.txt">

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- JSON-LD Structured Data - Halloween Optimized -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Haunted Coin of Fate - Halloween Fortune Teller",
      "alternateName": "Spooky Halloween Coin Flip",
      "url": "https://coinoffate.live/",
      "description": "Dare to flip the cursed Halloween coin? Experience supernatural fortune-telling with our haunted digital coin flip tool. Spooky animations, eerie sounds, and mystical predictions. Perfect for Halloween parties and spooky decision-making.",
      "applicationCategory": "EntertainmentApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "Haunted Coin of Fate",
        "url": "https://coinoffate.live/"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "ratingCount": "256",
        "reviewCount": "89"
      },
      "keywords": "halloween coin flip, haunted coin toss, spooky fortune teller, halloween decision maker, trick or treat coin, halloween game, spooky coin flip, halloween party game, scary fortune teller, haunted fortune"
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Haunted Coin of Fate",
      "url": "https://coinoffate.live/",
      "logo": "https://coinoffate.live/public/icon-512.png",
      "sameAs": [
        "https://coinoffate.live/"
      ],
      "description": "Spooky Halloween fortune-telling and decision-making tool with haunted animations and supernatural predictions"
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Haunted Coin of Fate",
      "url": "https://coinoffate.live/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://coinoffate.live/?s={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is the Haunted Coin of Fate?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The Haunted Coin of Fate is a spooky Halloween-themed digital coin flip tool that helps you make decisions with supernatural flair. It features haunted animations, eerie sound effects, and mystical fortune-telling quotes."
          }
        },
        {
          "@type": "Question",
          "name": "Is this a real fortune teller?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This is a fun Halloween-themed entertainment tool using probability algorithms. While the spooky theme adds atmosphere, the coin flips are generated using Markov chain probability for entertainment purposes only."
          }
        }
      ]
    }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow-x: hidden;
        }

        @keyframes hauntedFloat {
            0% { transform: translateX(0px) translateY(0px) rotate(0deg); }
            25% { transform: translateX(-30px) translateY(-20px) rotate(-5deg); }
            50% { transform: translateX(0px) translateY(-40px) rotate(0deg); }
            75% { transform: translateX(30px) translateY(-20px) rotate(5deg); }
            100% { transform: translateX(0px) translateY(0px) rotate(0deg); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes eeriePulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 30px rgba(255, 107, 0, 0.6); }
            50% { opacity: 0.7; box-shadow: 0 0 60px rgba(255, 107, 0, 0.9); }
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            75% { opacity: 0.9; }
        }

        @keyframes batFly {
            0% { transform: translateX(0) translateY(0) rotate(0deg); }
            25% { transform: translateX(-30px) translateY(15px) rotate(-10deg); }
            50% { transform: translateX(-50px) translateY(-10px) rotate(5deg); }
            75% { transform: translateX(-30px) translateY(20px) rotate(-5deg); }
            100% { transform: translateX(0) translateY(0) rotate(0deg); }
        }

        @keyframes ghostFloat {
            0% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-20px) rotate(3deg); opacity: 0.9; }
            100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
        }

        @keyframes fogDrift {
            0% { transform: translateX(0%) scaleY(1); }
            50% { transform: translateX(-10%) scaleY(1.1); }
            100% { transform: translateX(0%) scaleY(1); }
        }

        .haunted-flow {
            animation: hauntedFloat 20s ease-in-out infinite;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .animate-pulse {
            animation: eeriePulse 2s infinite;
        }

        .flicker {
            animation: flicker 3s infinite;
        }

        .coin-container {
            box-shadow: 0 0 80px rgba(255, 107, 0, 0.5), inset 0 0 80px rgba(255, 69, 0, 0.2);
            background: radial-gradient(circle at center, rgba(139, 69, 19, 0.3), rgba(0, 0, 0, 0.8));
        }

        .bg-gradient-text {
            background: linear-gradient(90deg, #ff6b00, #ffaa00, #ff6b00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 107, 0, 0.8);
        }

        .bat {
            animation: batFly 4s ease-in-out infinite;
        }

        .ghost {
            animation: ghostFloat 5s ease-in-out infinite;
        }

        .fog {
            animation: fogDrift 15s ease-in-out infinite;
        }

        /* Spooky glow effect */
        .spooky-glow {
            filter: drop-shadow(0 0 10px rgba(255, 107, 0, 0.7));
        }

        /* Creepy text shadow */
        .creepy-text {
            text-shadow:
                0 0 10px rgba(255, 107, 0, 0.8),
                0 0 20px rgba(255, 69, 0, 0.6),
                0 0 30px rgba(139, 69, 19, 0.4);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading Screen - Halloween -->
        <div id="loading" class="min-h-screen bg-black text-orange-500 font-mono relative overflow-hidden">
            <div class="absolute inset-0">
                <div id="fog-layer" class="fog"></div>
                <div id="halloween-rain"></div>
            </div>
            <div class="relative z-10 flex items-center justify-center min-h-screen">
                <div class="text-center px-4">
                    <div class="text-6xl mb-6 spooky-glow">👻</div>
                    <div class="text-4xl mb-4 flicker font-light tracking-wider creepy-text" style="font-family: Georgia, serif;">
                        Haunted Coin of Fate
                    </div>
                    <div class="text-lg text-orange-400 italic mb-2">
                        "Beware... the spirits are watching"
                    </div>
                    <div class="text-sm text-gray-500 mb-8">
                        Dare you flip the cursed coin?
                    </div>
                    <div class="mt-8">
                        <button onclick="startApp()" class="px-8 py-3 border-2 border-orange-500 text-orange-500 hover:bg-orange-500 hover:text-black transition-all duration-300 font-light tracking-wider spooky-glow">
                            ENTER IF YOU DARE
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="min-h-screen bg-black text-white relative overflow-hidden" style="display: none;">
            <!-- Background - Halloween Theme -->
            <div class="absolute inset-0">
                <div class="absolute inset-0 bg-gradient-to-br from-orange-900/20 via-black to-purple-900/20"></div>
                <div class="absolute inset-0 opacity-40 haunted-flow" style="
                    background-image:
                        radial-gradient(circle at 30% 70%, rgba(255,107,0,0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 30%, rgba(139,69,19,0.08) 0%, transparent 50%),
                        repeating-linear-gradient(45deg, transparent, transparent 100px, rgba(255,69,0,0.02) 102px),
                        repeating-linear-gradient(-45deg, transparent, transparent 100px, rgba(139,69,19,0.02) 102px);
                    background-size: 400px 400px, 300px 300px, 200px 200px, 200px 200px;
                "></div>

                <!-- Floating Halloween elements -->
                <div class="absolute inset-0" id="floating-elements"></div>

                <!-- Fog layer -->
                <div class="absolute bottom-0 left-0 right-0 h-64 bg-gradient-to-t from-gray-900/30 to-transparent fog"></div>
            </div>

            <!-- Header - Halloween -->
            <div class="relative text-center py-16 px-4 border-b border-orange-800/30">
                <div class="flex items-center justify-center gap-4 mb-8">
                    <div class="w-12 h-12 text-orange-500 flex items-center justify-center text-4xl ghost">🦇</div>
                    <div class="text-center">
                        <h1 class="text-6xl font-bold tracking-widest bg-gradient-text mb-2 creepy-text" style="font-family: Georgia, serif;">
                            HAUNTED COIN
                        </h1>
                        <div class="text-lg text-orange-400 italic font-light tracking-wider flicker" style="font-family: Georgia, serif;">
                            "The spirits have chosen..."
                        </div>
                        <div class="text-sm text-gray-500 mt-2">
                            Your fate awaits in the shadows
                        </div>
                    </div>
                    <div class="w-12 h-12 text-orange-500 flex items-center justify-center text-4xl ghost" style="animation-delay: 2s;">🦇</div>
                </div>

                <div id="premium-badge" class="inline-flex items-center gap-2 px-4 py-2 border border-orange-500/50 rounded bg-orange-900/20 spooky-glow" style="display: none;">
                    <span>🎃</span>
                    <span class="text-sm tracking-wide text-orange-400 font-light">HAUNTED PREMIUM</span>
                </div>
            </div>

            <!-- Quote Section - Halloween -->
            <div id="quote-section" class="relative py-12 px-6 border-b border-orange-800/20">
                <div class="max-w-2xl mx-auto text-center">
                    <div class="text-4xl mb-4">🔮</div>
                    <p id="current-quote" class="text-xl text-orange-300 italic leading-relaxed font-light flicker" style="font-family: Georgia, serif;">
                        "The spirits whisper your fortune..."
                    </p>
                    <p id="quote-translation" class="text-sm text-gray-500 mt-3 tracking-wider font-light">
                        What fate awaits in the darkness?
                    </p>
                </div>
            </div>

            <!-- Main Coin Section - Halloween -->
            <div class="relative max-w-lg mx-auto px-6 py-16">
                <!-- Coin -->
                <div class="flex justify-center mb-16">
                    <div class="relative">
                        <div id="coin" class="w-64 h-64 rounded-full border-4 border-orange-500 shadow-2xl flex items-center justify-center transform transition-all duration-2500 hover:scale-105 coin-container animate-pulse">
                            <div id="coin-content" class="text-center">
                                <div class="text-8xl mb-4 spooky-glow">🎃</div>
                                <div class="text-lg text-orange-300 tracking-wider font-light creepy-text">READY TO HAUNT</div>
                            </div>
                        </div>

                        <!-- Eerie glow rings -->
                        <div class="absolute inset-0 rounded-full border border-orange-500/40 scale-110 animate-pulse"></div>
                        <div class="absolute inset-0 rounded-full border border-orange-500/20 scale-125 animate-pulse" style="animation-delay: 1s;"></div>
                        <div class="absolute inset-0 rounded-full border border-purple-500/20 scale-140 animate-pulse" style="animation-delay: 2s;"></div>

                        <!-- Floating ghosts around coin -->
                        <div class="absolute -left-12 top-1/4 text-3xl ghost" style="animation-delay: 0.5s;">👻</div>
                        <div class="absolute -right-12 top-1/3 text-3xl ghost" style="animation-delay: 1.5s;">👻</div>
                    </div>
                </div>

                <!-- Flip Button - Halloween -->
                <div class="text-center mb-12">
                    <button id="flip-btn" onclick="flipCoin()" class="px-16 py-5 border-2 border-orange-500 hover:bg-orange-500 hover:text-black transition-all duration-300 font-bold tracking-widest text-xl transform hover:scale-105 spooky-glow creepy-text" style="font-family: Georgia, serif;">
                        🎃 SUMMON FATE 🎃
                    </button>
                </div>

                <!-- Stats - Halloween -->
                <div class="grid grid-cols-3 gap-6 mb-12">
                    <div class="text-center p-6 border border-orange-800/30 bg-orange-900/10 rounded spooky-glow">
                        <div class="text-3xl mb-2">⚰️</div>
                        <div id="total-count" class="text-4xl font-bold text-orange-400 mb-2 creepy-text" style="font-family: Georgia, serif;">0</div>
                        <div class="text-xs text-gray-500 tracking-wider font-light">SUMMONS</div>
                    </div>
                    <div class="text-center p-6 border border-orange-800/30 bg-orange-900/10 rounded spooky-glow">
                        <div class="text-3xl mb-2">🎃</div>
                        <div id="heads-count" class="text-4xl font-bold text-orange-400 mb-2 creepy-text" style="font-family: Georgia, serif;">0</div>
                        <div class="text-xs text-gray-500 tracking-wider font-light">TRICK</div>
                    </div>
                    <div class="text-center p-6 border border-orange-800/30 bg-orange-900/10 rounded spooky-glow">
                        <div class="text-3xl mb-2">🍬</div>
                        <div id="tails-count" class="text-4xl font-bold text-orange-400 mb-2 creepy-text" style="font-family: Georgia, serif;">0</div>
                        <div class="text-xs text-gray-500 tracking-wider font-light">TREAT</div>
                    </div>
                </div>

                <!-- History - Halloween -->
                <div id="history-section" class="mb-12" style="display: none;">
                    <h3 class="text-center text-lg font-light mb-6 tracking-wider text-orange-400 flicker" style="font-family: Georgia, serif;">
                        👻 Spirit Chronicle 👻
                    </h3>
                    <div class="flex justify-center">
                        <div id="history-display" class="flex gap-3"></div>
                    </div>
                </div>

                <!-- Free Limit Warning - Halloween -->
                <div id="limit-warning" class="mb-8 p-4 border-2 border-red-600/60 bg-red-900/30 text-center rounded spooky-glow" style="display: none;">
                    <div class="text-3xl mb-2">⚠️</div>
                    <p class="text-red-300 text-sm font-light">
                        The spirits grow weary... <span id="remaining-flips">2</span> summons remaining!
                    </p>
                </div>

                <!-- Reset Button - Halloween -->
                <div class="text-center">
                    <button onclick="resetApp()" class="px-10 py-3 border border-gray-700 hover:border-orange-500 text-gray-500 hover:text-orange-400 transition-all duration-300 font-light tracking-wider" style="font-family: Georgia, serif;">
                        🕷️ RESET RITUAL 🕷️
                    </button>
                </div>
            </div>

            <!-- Subscription Modal - Halloween -->
            <div id="subscription-modal" class="fixed inset-0 bg-black/95 flex items-center justify-center p-4" style="display: none;">
                <div class="bg-gradient-to-br from-orange-900/30 to-black border-2 border-orange-500 p-8 max-w-md w-full text-center relative rounded spooky-glow">
                    <div class="absolute inset-0 bg-orange-500/5 rounded"></div>
                    <div class="relative z-10">
                        <div class="mb-6">
                            <div class="text-6xl mx-auto mb-6 flicker">🔮</div>
                            <h2 class="text-3xl font-bold mb-4 tracking-wider text-orange-400 creepy-text" style="font-family: Georgia, serif;">
                                Unleash Eternal Spirits
                            </h2>
                            <p class="text-gray-300 leading-relaxed font-light">
                                The spirits demand tribute for unlimited haunted flips...
                            </p>
                        </div>

                        <div class="border-2 border-orange-800/50 p-6 mb-8 bg-orange-900/20 rounded spooky-glow">
                            <div class="text-4xl font-bold text-orange-400 mb-4 creepy-text" style="font-family: Georgia, serif;">$2.99/month</div>
                            <div class="space-y-3 text-sm text-gray-300 font-light">
                                <div class="flex items-center justify-center gap-3">
                                    <span>♾️</span>
                                    <span>Unlimited haunted summons</span>
                                </div>
                                <div class="flex items-center justify-center gap-3">
                                    <span>🎃</span>
                                    <span>Haunted Premium badge</span>
                                </div>
                                <div class="flex items-center justify-center gap-3">
                                    <span>👻</span>
                                    <span>Exclusive spooky sound effects</span>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <button onclick="buyPremium()" class="w-full py-3 bg-orange-500 text-black hover:bg-orange-400 transition-all duration-300 font-bold tracking-wider spooky-glow" style="font-family: Georgia, serif;">
                                🎃 SUMMON UNLIMITED POWER 🎃
                            </button>
                            <button onclick="closeModal()" class="w-full py-3 border border-gray-600 hover:border-orange-500 text-gray-400 hover:text-orange-400 transition-all duration-300 font-light tracking-wider" style="font-family: Georgia, serif;">
                                FLEE IN TERROR
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer - Halloween -->
            <div class="relative border-t border-orange-800/30 py-8 text-center">
                <div class="space-y-3 text-xs text-gray-600 font-light">
                    <div class="flex justify-center gap-4 text-2xl mb-4">
                        <span class="ghost">👻</span>
                        <span class="bat">🦇</span>
                        <span class="ghost" style="animation-delay: 1s;">👻</span>
                        <span class="bat" style="animation-delay: 2s;">🦇</span>
                        <span class="ghost" style="animation-delay: 3s;">👻</span>
                    </div>
                    <p class="text-orange-500/70">Powered by Spooky Markov Chain Probability</p>
                    <p style="font-family: Georgia, serif;" class="italic">"In the shadows, your fate awaits..."</p>
                    <p class="text-xs">Happy Halloween! 🎃 | Made with supernatural energy</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let tosses = 0;
        let history = [];
        let isPremium = false;
        let markovState = 'H';
        let isFlipping = false;

        const markovMatrix = {
            'H': { 'H': 0.45, 'T': 0.55 },
            'T': { 'H': 0.55, 'T': 0.45 }
        };

        // Halloween spooky quotes
        const hauntedQuotes = [
            "The spirits have spoken... listen closely|Your fate echoes through the darkness",
            "Beware the shadows... they whisper secrets|Darkness reveals hidden truths",
            "The veil between worlds grows thin|What lies beyond beckons you",
            "Ancient forces guide your destiny|The supernatural realm calls",
            "In darkness, truth is revealed|Your fortune awaits in shadow",
            "The cursed coin knows your fate|Supernatural powers at work",
            "Spirits dance in the moonlight|Your destiny is written in stars",
            "The haunted realm has chosen|Mystical energies surround you",
            "Beware what the darkness brings|Fortune favors the brave souls",
            "The spectral voices cry out|Your path is illuminated by spirits",
            "Trick or treat, fate awaits|The spirits decide your fortune",
            "Eternal spirits guide the coin|Supernatural forces align"
        ];

        // Sound effects (using Web Audio API for spooky sounds)
        let audioContext;
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playEerieSound() {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.5);

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function playSpookyWhoosh() {
            initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.3);

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Halloween rain effect (falling leaves and bats)
        function createHalloweenRain() {
            const container = document.getElementById('halloween-rain');
            const halloweenChars = ['🦇', '🍂', '🍁', '💀', '👻'];
            const columns = Math.floor(window.innerWidth / 50);

            for (let i = 0; i < columns; i++) {
                const drop = document.createElement('div');
                drop.style.position = 'absolute';
                drop.style.left = i * 50 + 'px';
                drop.style.top = Math.random() * -1000 + 'px';
                drop.style.fontSize = '20px';
                drop.style.opacity = '0.3';
                drop.style.animation = `fall ${5 + Math.random() * 8}s linear infinite`;
                drop.style.animationDelay = Math.random() * 5 + 's';

                drop.textContent = halloweenChars[Math.floor(Math.random() * halloweenChars.length)];
                container.appendChild(drop);
            }
        }

        // Create floating Halloween elements
        function createFloatingElements() {
            const container = document.getElementById('floating-elements');
            const elements = ['🦇', '👻', '🕷️', '🕸️', '💀', '🎃'];

            for (let i = 0; i < 20; i++) {
                const element = document.createElement('div');
                element.className = 'absolute opacity-20 text-2xl';
                element.style.left = Math.random() * 100 + '%';
                element.style.top = Math.random() * 100 + '%';

                // Alternate between bat and ghost animations
                if (i % 2 === 0) {
                    element.className += ' bat';
                } else {
                    element.className += ' ghost';
                }

                element.style.animationDelay = Math.random() * 5 + 's';
                element.style.animationDuration = (4 + Math.random() * 4) + 's';
                element.textContent = elements[Math.floor(Math.random() * elements.length)];
                container.appendChild(element);
            }
        }

        // Create spooky particle burst effect
        function createParticleBurst(x, y) {
            const particles = ['✨', '⭐', '💫', '🌟'];
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'absolute text-2xl';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.pointerEvents = 'none';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];

                const angle = (i / 12) * Math.PI * 2;
                const velocity = 100 + Math.random() * 100;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 1000,
                    easing: 'cubic-bezier(0, .9, .57, 1)'
                });

                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        // Start app
        function startApp() {
            playSpookyWhoosh();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            createFloatingElements();
            updateQuote();
        }

        // Update quote - Halloween version
        function updateQuote() {
            const quote = hauntedQuotes[Math.floor(Math.random() * hauntedQuotes.length)];
            const parts = quote.split('|');
            document.getElementById('current-quote').textContent = `"${parts[0]}"`;
            document.getElementById('quote-translation').textContent = parts[1];
        }

        // Markov prediction
        function getMarkovPrediction() {
            const probabilities = markovMatrix[markovState];
            const random = Math.random();
            return random < probabilities['H'] ? 'H' : 'T';
        }

        // Flip coin - Halloween version with sound effects
        function flipCoin() {
            if (!isPremium && tosses >= 10) {
                playEerieSound();
                document.getElementById('subscription-modal').style.display = 'flex';
                return;
            }

            if (isFlipping) return;

            isFlipping = true;
            playSpookyWhoosh();

            const coin = document.getElementById('coin');
            const coinContent = document.getElementById('coin-content');
            const flipBtn = document.getElementById('flip-btn');

            coin.classList.add('animate-spin');
            coin.style.transform = 'scale(1.2)';
            flipBtn.textContent = '🔮 SUMMONING... 🔮';
            flipBtn.disabled = true;

            coinContent.innerHTML = `
                <div class="text-9xl animate-pulse mb-4 spooky-glow">🌀</div>
                <div class="text-lg text-orange-300 tracking-wider font-light animate-pulse creepy-text">SPIRITS DECIDING...</div>
            `;

            // Create particle effects during spin
            setTimeout(() => {
                const coinRect = coin.getBoundingClientRect();
                const centerX = coinRect.left + coinRect.width / 2;
                const centerY = coinRect.top + coinRect.height / 2;
                createParticleBurst(centerX, centerY);
            }, 1000);

            setTimeout(() => {
                playEerieSound();

                const result = getMarkovPrediction();
                markovState = result;
                history = [result, ...history.slice(0, 9)];
                tosses++;

                coin.classList.remove('animate-spin');
                coin.style.transform = 'scale(1)';

                // Trick or Treat result
                const isTrick = result === 'H';
                coinContent.innerHTML = `
                    <div class="text-9xl mb-3 spooky-glow">${isTrick ? '🎃' : '🍬'}</div>
                    <div class="text-2xl text-orange-400 tracking-wider font-bold creepy-text">${isTrick ? 'TRICK!' : 'TREAT!'}</div>
                `;

                updateStats();
                updateHistory();
                updateQuote();
                checkLimit();

                flipBtn.textContent = '🎃 SUMMON FATE 🎃';
                flipBtn.disabled = false;
                isFlipping = false;
            }, 2500);
        }

        // Update stats
        function updateStats() {
            document.getElementById('total-count').textContent = tosses;
            document.getElementById('heads-count').textContent = history.filter(h => h === 'H').length;
            document.getElementById('tails-count').textContent = history.filter(h => h === 'T').length;
        }

        // Update history - Halloween version
        function updateHistory() {
            if (history.length > 0) {
                document.getElementById('history-section').style.display = 'block';
                const historyDisplay = document.getElementById('history-display');
                historyDisplay.innerHTML = '';

                history.forEach(flip => {
                    const element = document.createElement('div');
                    const isTrick = flip === 'H';
                    element.className = `w-12 h-12 rounded-full border-2 flex items-center justify-center text-2xl ${
                        isTrick
                            ? 'bg-orange-500 border-orange-500 spooky-glow'
                            : 'bg-purple-900/50 border-orange-400 spooky-glow'
                    }`;
                    element.textContent = isTrick ? '🎃' : '🍬';
                    historyDisplay.appendChild(element);
                });
            }
        }

        // Check limit
        function checkLimit() {
            if (!isPremium && tosses >= 8) {
                const remaining = 10 - tosses;
                document.getElementById('remaining-flips').textContent = remaining;
                document.getElementById('limit-warning').style.display = 'block';
            }
        }

        // Buy premium
        function buyPremium() {
            isPremium = true;
            document.getElementById('subscription-modal').style.display = 'none';
            document.getElementById('premium-badge').style.display = 'inline-flex';
            document.getElementById('limit-warning').style.display = 'none';
        }

        // Close modal
        function closeModal() {
            document.getElementById('subscription-modal').style.display = 'none';
        }

        // Reset app - Halloween version
        function resetApp() {
            playSpookyWhoosh();
            tosses = 0;
            history = [];
            markovState = 'H';

            document.getElementById('coin-content').innerHTML = `
                <div class="text-8xl mb-4 spooky-glow">🎃</div>
                <div class="text-lg text-orange-300 tracking-wider font-light creepy-text">READY TO HAUNT</div>
            `;

            updateStats();
            document.getElementById('history-section').style.display = 'none';
            document.getElementById('limit-warning').style.display = 'none';
            updateQuote();
        }

        // Add CSS animation for falling
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    transform: translateY(100vh);
                }
            }
        `;
        document.head.appendChild(style);

        // Initialize Halloween rain
        createHalloweenRain();
    </script>
</body>
</html>